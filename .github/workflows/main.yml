name: Ubuntu VNC via Tailscale

on:
  workflow_dispatch:
    inputs:
      action:
        description: "start or stop VNC desktop"
        required: true
        default: "start"

jobs:
  vnc:
    runs-on: [self-hosted, linux, vps]
    timeout-minutes: 360   # full 6 hours max

    steps:
      - name: Show Tailscale IP
        run: |
          echo "Tailscale IP:"
          tailscale ip -4

      - name: Start Ubuntu VNC Desktop
        if: github.event.inputs.action == 'start'
        run: |
          docker rm -f ubuntu-vnc || true

          docker run -d \
            --name ubuntu-vnc \
            -p 5901:5901 \
            -e VNC_PASSWORD=${{ secrets.VNC_PASSWORD }} \
            tiryoh/ubuntu-vnc-desktop

          echo "====================================="
          echo "UBUNTU VNC DESKTOP STARTED"
          echo "Tailscale IP : $(tailscale ip -4)"
          echo "VNC PORT     : 5901"
          echo "VNC PASSWORD : ${{ secrets.VNC_PASSWORD }}"
          echo "====================================="

      - name: Stop Ubuntu VNC Desktop
        if: github.event.inputs.action == 'stop'
        run: |
          docker stop ubuntu-vnc || true
          docker rm ubuntu-vnc || true
          echo "Ubuntu VNC Desktop stopped"
