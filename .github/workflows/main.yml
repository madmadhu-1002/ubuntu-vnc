name: Ubuntu VNC with Tailscale

on:
  workflow_dispatch:

jobs:
  vnc:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh

      - name: Start Tailscale
        run: |
          sudo tailscale up \
            --authkey=${{ secrets.TAILSCALE_AUTHKEY }} \
            --hostname=github-vnc \
            --accept-dns=false

      - name: Pull Ubuntu VNC Image
        run: |
          docker pull dorowu/ubuntu-desktop-lxde-vnc

      - name: Run VNC Container
        run: |
          docker run -d \
            --name ubuntu-vnc \
            --network host \
            -e USER=root \
            -e PASSWORD=github \
            dorowu/ubuntu-desktop-lxde-vnc

      - name: Show Connection Details
        run: |
          echo "===================================="
          echo "‚úÖ VNC SERVER IS READY"
          echo ""
          echo "üîê VNC LOGIN CREDENTIALS"
          echo "Username: root"
          echo "Password: github"
          echo ""
          echo "üåê CONNECT VIA TAILSCALE IP"
          tailscale ip -4
          echo ""
          echo "üì° VNC PORT: 5900"
          echo "===================================="

      - name: Keep Runner Alive
        run: |
          echo "Keeping runner alive..."
          sleep 6h
